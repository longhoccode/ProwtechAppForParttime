{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\truon\\\\source\\\\repos\\\\QuyLongTruong\\\\ProwtechAppForParttime\\\\prowtech-app\\\\frontend-web\\\\src\\\\components\\\\modal\\\\AssignStoreModal.js\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect } from \"react\";\nimport BaseModal from \"../BaseModal\";\nimport api from \"../../services/api\";\nimport FilterBar from \"../FilterBar\"; // üëà th√™m v√†o\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nfunction AssignStoreModal({\n  isOpen,\n  onClose,\n  onSave,\n  campaignId,\n  initiallyAssignedIds\n}) {\n  _s();\n  const [allStores, setAllStores] = useState([]);\n  const [selectedStoreIds, setSelectedStoreIds] = useState(new Set());\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState(\"\");\n  const [filterKeyword, setFilterKeyword] = useState(\"\"); // üëà thay th·∫ø searchTerm\n\n  useEffect(() => {\n    if (isOpen) {\n      setFilterKeyword(\"\");\n      setLoading(true);\n      setError(\"\");\n      api.get(\"/stores\").then(res => {\n        setAllStores(res.data.data || []);\n        setSelectedStoreIds(new Set(initiallyAssignedIds));\n      }).catch(() => setError(\"Kh√¥ng th·ªÉ t·∫£i danh s√°ch c·ª≠a h√†ng.\")).finally(() => setLoading(false));\n    }\n  }, [isOpen, initiallyAssignedIds]);\n  const handleToggleStore = id => {\n    setSelectedStoreIds(prev => {\n      const copy = new Set(prev);\n      copy.has(id) ? copy.delete(id) : copy.add(id);\n      return copy;\n    });\n  };\n  const handleSave = async () => {\n    const orig = new Set(initiallyAssignedIds);\n    const curr = selectedStoreIds;\n    const add = [...curr].filter(id => !orig.has(id));\n    const remove = [...orig].filter(id => !curr.has(id));\n    setLoading(true);\n    setError(\"\");\n    try {\n      await Promise.all([...add.map(id => api.post(`/campaigns/${campaignId}/stores`, {\n        store_id: id\n      })), ...remove.map(id => api.delete(`/campaigns/${campaignId}/stores/${id}`))]);\n      onSave();\n    } catch {\n      setError(\"L∆∞u thay ƒë·ªïi th·∫•t b·∫°i.\");\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  // √Åp d·ª•ng filterKeyword\n  const filteredStores = allStores.filter(store => `${store.board_name || \"\"} ${store.store_code || \"\"} ${store.address || \"\"}`.toLowerCase().includes(filterKeyword.toLowerCase()));\n  return /*#__PURE__*/_jsxDEV(BaseModal, {\n    isOpen: isOpen,\n    onClose: onClose,\n    title: \"Ph\\xE2n c\\xF4ng c\\u1EEDa h\\xE0ng cho chi\\u1EBFn d\\u1ECBch\",\n    actions: /*#__PURE__*/_jsxDEV(_Fragment, {\n      children: [/*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"btn btn-danger btn-sm\",\n        onClick: onClose,\n        disabled: loading,\n        children: \"H\\u1EE7y\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 71,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"btn btn-primary btn-sm\",\n        onClick: handleSave,\n        disabled: loading,\n        children: loading ? \"ƒêang l∆∞u...\" : \"L∆∞u thay ƒë·ªïi\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 72,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true),\n    children: [error && /*#__PURE__*/_jsxDEV(\"p\", {\n      className: \"alert alert-error\",\n      children: error\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 78,\n      columnNumber: 17\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"modal-row\",\n      children: /*#__PURE__*/_jsxDEV(FilterBar, {\n        keyword: filterKeyword,\n        onKeywordChange: setFilterKeyword,\n        showProvinceFilter: false,\n        showDistrictFilter: false\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 82,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 81,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"modal-content\",\n      style: {\n        maxHeight: \"300px\",\n        overflowY: \"auto\"\n      },\n      children: filteredStores.map(store => /*#__PURE__*/_jsxDEV(\"label\", {\n        className: \"modal-row\",\n        children: [/*#__PURE__*/_jsxDEV(\"input\", {\n          type: \"checkbox\",\n          checked: selectedStoreIds.has(store.id),\n          onChange: () => handleToggleStore(store.id)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 93,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"modal-label\",\n          children: store.store_code\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 98,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"modal-value\",\n          children: store.address\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 99,\n          columnNumber: 13\n        }, this)]\n      }, store.id, true, {\n        fileName: _jsxFileName,\n        lineNumber: 92,\n        columnNumber: 11\n      }, this))\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 90,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 65,\n    columnNumber: 5\n  }, this);\n}\n_s(AssignStoreModal, \"an6l5fFJGVw3BihXt91oYR3zHXk=\");\n_c = AssignStoreModal;\nexport default AssignStoreModal;\nvar _c;\n$RefreshReg$(_c, \"AssignStoreModal\");","map":{"version":3,"names":["React","useState","useEffect","BaseModal","api","FilterBar","jsxDEV","_jsxDEV","Fragment","_Fragment","AssignStoreModal","isOpen","onClose","onSave","campaignId","initiallyAssignedIds","_s","allStores","setAllStores","selectedStoreIds","setSelectedStoreIds","Set","loading","setLoading","error","setError","filterKeyword","setFilterKeyword","get","then","res","data","catch","finally","handleToggleStore","id","prev","copy","has","delete","add","handleSave","orig","curr","filter","remove","Promise","all","map","post","store_id","filteredStores","store","board_name","store_code","address","toLowerCase","includes","title","actions","children","className","onClick","disabled","fileName","_jsxFileName","lineNumber","columnNumber","keyword","onKeywordChange","showProvinceFilter","showDistrictFilter","style","maxHeight","overflowY","type","checked","onChange","_c","$RefreshReg$"],"sources":["C:/Users/truon/source/repos/QuyLongTruong/ProwtechAppForParttime/prowtech-app/frontend-web/src/components/modal/AssignStoreModal.js"],"sourcesContent":["import React, { useState, useEffect } from \"react\";\r\nimport BaseModal from \"../BaseModal\";\r\nimport api from \"../../services/api\";\r\nimport FilterBar from \"../FilterBar\"; // üëà th√™m v√†o\r\n\r\nfunction AssignStoreModal({ isOpen, onClose, onSave, campaignId, initiallyAssignedIds }) {\r\n  const [allStores, setAllStores] = useState([]);\r\n  const [selectedStoreIds, setSelectedStoreIds] = useState(new Set());\r\n  const [loading, setLoading] = useState(false);\r\n  const [error, setError] = useState(\"\");\r\n  const [filterKeyword, setFilterKeyword] = useState(\"\"); // üëà thay th·∫ø searchTerm\r\n\r\n  useEffect(() => {\r\n    if (isOpen) {\r\n      setFilterKeyword(\"\");\r\n      setLoading(true);\r\n      setError(\"\");\r\n      api.get(\"/stores\")\r\n        .then((res) => {\r\n          setAllStores(res.data.data || []);\r\n          setSelectedStoreIds(new Set(initiallyAssignedIds));\r\n        })\r\n        .catch(() => setError(\"Kh√¥ng th·ªÉ t·∫£i danh s√°ch c·ª≠a h√†ng.\"))\r\n        .finally(() => setLoading(false));\r\n    }\r\n  }, [isOpen, initiallyAssignedIds]);\r\n\r\n  const handleToggleStore = (id) => {\r\n    setSelectedStoreIds((prev) => {\r\n      const copy = new Set(prev);\r\n      copy.has(id) ? copy.delete(id) : copy.add(id);\r\n      return copy;\r\n    });\r\n  };\r\n\r\n  const handleSave = async () => {\r\n    const orig = new Set(initiallyAssignedIds);\r\n    const curr = selectedStoreIds;\r\n    const add = [...curr].filter(id => !orig.has(id));\r\n    const remove = [...orig].filter(id => !curr.has(id));\r\n\r\n    setLoading(true);\r\n    setError(\"\");\r\n    try {\r\n      await Promise.all([\r\n        ...add.map(id => api.post(`/campaigns/${campaignId}/stores`, { store_id: id })),\r\n        ...remove.map(id => api.delete(`/campaigns/${campaignId}/stores/${id}`))\r\n      ]);\r\n      onSave();\r\n    } catch {\r\n      setError(\"L∆∞u thay ƒë·ªïi th·∫•t b·∫°i.\");\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  // √Åp d·ª•ng filterKeyword\r\n  const filteredStores = allStores.filter(store =>\r\n    `${store.board_name || \"\"} ${store.store_code || \"\"} ${store.address || \"\"}`\r\n      .toLowerCase()\r\n      .includes(filterKeyword.toLowerCase())\r\n  );\r\n\r\n  return (\r\n    <BaseModal\r\n      isOpen={isOpen}\r\n      onClose={onClose}\r\n      title=\"Ph√¢n c√¥ng c·ª≠a h√†ng cho chi·∫øn d·ªãch\"\r\n      actions={\r\n        <>\r\n          <button className=\"btn btn-danger btn-sm\" onClick={onClose} disabled={loading}>H·ªßy</button>\r\n          <button className=\"btn btn-primary btn-sm\" onClick={handleSave} disabled={loading}>\r\n            {loading ? \"ƒêang l∆∞u...\" : \"L∆∞u thay ƒë·ªïi\"}\r\n          </button>\r\n        </>\r\n      }\r\n    >\r\n      {error && <p className=\"alert alert-error\">{error}</p>}\r\n\r\n      {/* üëá Thay √¥ input search b·∫±ng FilterBar */}\r\n      <div className=\"modal-row\">\r\n        <FilterBar\r\n          keyword={filterKeyword}\r\n          onKeywordChange={setFilterKeyword}\r\n          showProvinceFilter={false}\r\n          showDistrictFilter={false}\r\n        />\r\n      </div>\r\n\r\n      <div className=\"modal-content\" style={{ maxHeight: \"300px\", overflowY: \"auto\" }}>\r\n        {filteredStores.map(store => (\r\n          <label key={store.id} className=\"modal-row\">\r\n            <input\r\n              type=\"checkbox\"\r\n              checked={selectedStoreIds.has(store.id)}\r\n              onChange={() => handleToggleStore(store.id)}\r\n            />\r\n            <div className=\"modal-label\">{store.store_code}</div>\r\n            <div className=\"modal-value\">{store.address}</div>\r\n          </label>\r\n        ))}\r\n      </div>\r\n    </BaseModal>\r\n  );\r\n}\r\n\r\nexport default AssignStoreModal;\r\n"],"mappings":";;AAAA,OAAOA,KAAK,IAAIC,QAAQ,EAAEC,SAAS,QAAQ,OAAO;AAClD,OAAOC,SAAS,MAAM,cAAc;AACpC,OAAOC,GAAG,MAAM,oBAAoB;AACpC,OAAOC,SAAS,MAAM,cAAc,CAAC,CAAC;AAAA,SAAAC,MAAA,IAAAC,OAAA,EAAAC,QAAA,IAAAC,SAAA;AAEtC,SAASC,gBAAgBA,CAAC;EAAEC,MAAM;EAAEC,OAAO;EAAEC,MAAM;EAAEC,UAAU;EAAEC;AAAqB,CAAC,EAAE;EAAAC,EAAA;EACvF,MAAM,CAACC,SAAS,EAAEC,YAAY,CAAC,GAAGjB,QAAQ,CAAC,EAAE,CAAC;EAC9C,MAAM,CAACkB,gBAAgB,EAAEC,mBAAmB,CAAC,GAAGnB,QAAQ,CAAC,IAAIoB,GAAG,CAAC,CAAC,CAAC;EACnE,MAAM,CAACC,OAAO,EAAEC,UAAU,CAAC,GAAGtB,QAAQ,CAAC,KAAK,CAAC;EAC7C,MAAM,CAACuB,KAAK,EAAEC,QAAQ,CAAC,GAAGxB,QAAQ,CAAC,EAAE,CAAC;EACtC,MAAM,CAACyB,aAAa,EAAEC,gBAAgB,CAAC,GAAG1B,QAAQ,CAAC,EAAE,CAAC,CAAC,CAAC;;EAExDC,SAAS,CAAC,MAAM;IACd,IAAIS,MAAM,EAAE;MACVgB,gBAAgB,CAAC,EAAE,CAAC;MACpBJ,UAAU,CAAC,IAAI,CAAC;MAChBE,QAAQ,CAAC,EAAE,CAAC;MACZrB,GAAG,CAACwB,GAAG,CAAC,SAAS,CAAC,CACfC,IAAI,CAAEC,GAAG,IAAK;QACbZ,YAAY,CAACY,GAAG,CAACC,IAAI,CAACA,IAAI,IAAI,EAAE,CAAC;QACjCX,mBAAmB,CAAC,IAAIC,GAAG,CAACN,oBAAoB,CAAC,CAAC;MACpD,CAAC,CAAC,CACDiB,KAAK,CAAC,MAAMP,QAAQ,CAAC,mCAAmC,CAAC,CAAC,CAC1DQ,OAAO,CAAC,MAAMV,UAAU,CAAC,KAAK,CAAC,CAAC;IACrC;EACF,CAAC,EAAE,CAACZ,MAAM,EAAEI,oBAAoB,CAAC,CAAC;EAElC,MAAMmB,iBAAiB,GAAIC,EAAE,IAAK;IAChCf,mBAAmB,CAAEgB,IAAI,IAAK;MAC5B,MAAMC,IAAI,GAAG,IAAIhB,GAAG,CAACe,IAAI,CAAC;MAC1BC,IAAI,CAACC,GAAG,CAACH,EAAE,CAAC,GAAGE,IAAI,CAACE,MAAM,CAACJ,EAAE,CAAC,GAAGE,IAAI,CAACG,GAAG,CAACL,EAAE,CAAC;MAC7C,OAAOE,IAAI;IACb,CAAC,CAAC;EACJ,CAAC;EAED,MAAMI,UAAU,GAAG,MAAAA,CAAA,KAAY;IAC7B,MAAMC,IAAI,GAAG,IAAIrB,GAAG,CAACN,oBAAoB,CAAC;IAC1C,MAAM4B,IAAI,GAAGxB,gBAAgB;IAC7B,MAAMqB,GAAG,GAAG,CAAC,GAAGG,IAAI,CAAC,CAACC,MAAM,CAACT,EAAE,IAAI,CAACO,IAAI,CAACJ,GAAG,CAACH,EAAE,CAAC,CAAC;IACjD,MAAMU,MAAM,GAAG,CAAC,GAAGH,IAAI,CAAC,CAACE,MAAM,CAACT,EAAE,IAAI,CAACQ,IAAI,CAACL,GAAG,CAACH,EAAE,CAAC,CAAC;IAEpDZ,UAAU,CAAC,IAAI,CAAC;IAChBE,QAAQ,CAAC,EAAE,CAAC;IACZ,IAAI;MACF,MAAMqB,OAAO,CAACC,GAAG,CAAC,CAChB,GAAGP,GAAG,CAACQ,GAAG,CAACb,EAAE,IAAI/B,GAAG,CAAC6C,IAAI,CAAC,cAAcnC,UAAU,SAAS,EAAE;QAAEoC,QAAQ,EAAEf;MAAG,CAAC,CAAC,CAAC,EAC/E,GAAGU,MAAM,CAACG,GAAG,CAACb,EAAE,IAAI/B,GAAG,CAACmC,MAAM,CAAC,cAAczB,UAAU,WAAWqB,EAAE,EAAE,CAAC,CAAC,CACzE,CAAC;MACFtB,MAAM,CAAC,CAAC;IACV,CAAC,CAAC,MAAM;MACNY,QAAQ,CAAC,wBAAwB,CAAC;IACpC,CAAC,SAAS;MACRF,UAAU,CAAC,KAAK,CAAC;IACnB;EACF,CAAC;;EAED;EACA,MAAM4B,cAAc,GAAGlC,SAAS,CAAC2B,MAAM,CAACQ,KAAK,IAC3C,GAAGA,KAAK,CAACC,UAAU,IAAI,EAAE,IAAID,KAAK,CAACE,UAAU,IAAI,EAAE,IAAIF,KAAK,CAACG,OAAO,IAAI,EAAE,EAAE,CACzEC,WAAW,CAAC,CAAC,CACbC,QAAQ,CAAC/B,aAAa,CAAC8B,WAAW,CAAC,CAAC,CACzC,CAAC;EAED,oBACEjD,OAAA,CAACJ,SAAS;IACRQ,MAAM,EAAEA,MAAO;IACfC,OAAO,EAAEA,OAAQ;IACjB8C,KAAK,EAAC,2DAAmC;IACzCC,OAAO,eACLpD,OAAA,CAAAE,SAAA;MAAAmD,QAAA,gBACErD,OAAA;QAAQsD,SAAS,EAAC,uBAAuB;QAACC,OAAO,EAAElD,OAAQ;QAACmD,QAAQ,EAAEzC,OAAQ;QAAAsC,QAAA,EAAC;MAAG;QAAAI,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAQ,CAAC,eAC3F5D,OAAA;QAAQsD,SAAS,EAAC,wBAAwB;QAACC,OAAO,EAAErB,UAAW;QAACsB,QAAQ,EAAEzC,OAAQ;QAAAsC,QAAA,EAC/EtC,OAAO,GAAG,aAAa,GAAG;MAAc;QAAA0C,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACnC,CAAC;IAAA,eACT,CACH;IAAAP,QAAA,GAEApC,KAAK,iBAAIjB,OAAA;MAAGsD,SAAS,EAAC,mBAAmB;MAAAD,QAAA,EAAEpC;IAAK;MAAAwC,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OAAI,CAAC,eAGtD5D,OAAA;MAAKsD,SAAS,EAAC,WAAW;MAAAD,QAAA,eACxBrD,OAAA,CAACF,SAAS;QACR+D,OAAO,EAAE1C,aAAc;QACvB2C,eAAe,EAAE1C,gBAAiB;QAClC2C,kBAAkB,EAAE,KAAM;QAC1BC,kBAAkB,EAAE;MAAM;QAAAP,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAC3B;IAAC;MAAAH,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OACC,CAAC,eAEN5D,OAAA;MAAKsD,SAAS,EAAC,eAAe;MAACW,KAAK,EAAE;QAAEC,SAAS,EAAE,OAAO;QAAEC,SAAS,EAAE;MAAO,CAAE;MAAAd,QAAA,EAC7ET,cAAc,CAACH,GAAG,CAACI,KAAK,iBACvB7C,OAAA;QAAsBsD,SAAS,EAAC,WAAW;QAAAD,QAAA,gBACzCrD,OAAA;UACEoE,IAAI,EAAC,UAAU;UACfC,OAAO,EAAEzD,gBAAgB,CAACmB,GAAG,CAACc,KAAK,CAACjB,EAAE,CAAE;UACxC0C,QAAQ,EAAEA,CAAA,KAAM3C,iBAAiB,CAACkB,KAAK,CAACjB,EAAE;QAAE;UAAA6B,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAC7C,CAAC,eACF5D,OAAA;UAAKsD,SAAS,EAAC,aAAa;UAAAD,QAAA,EAAER,KAAK,CAACE;QAAU;UAAAU,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAM,CAAC,eACrD5D,OAAA;UAAKsD,SAAS,EAAC,aAAa;UAAAD,QAAA,EAAER,KAAK,CAACG;QAAO;UAAAS,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAM,CAAC;MAAA,GAPxCf,KAAK,CAACjB,EAAE;QAAA6B,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAQb,CACR;IAAC;MAAAH,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OACC,CAAC;EAAA;IAAAH,QAAA,EAAAC,YAAA;IAAAC,UAAA;IAAAC,YAAA;EAAA,OACG,CAAC;AAEhB;AAACnD,EAAA,CAnGQN,gBAAgB;AAAAoE,EAAA,GAAhBpE,gBAAgB;AAqGzB,eAAeA,gBAAgB;AAAC,IAAAoE,EAAA;AAAAC,YAAA,CAAAD,EAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}